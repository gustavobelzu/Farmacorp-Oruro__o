{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>FARMACORP - Sucursales</title>
<link rel="stylesheet" href="{% static 'styles.css' %}">
<style>
body { font-family: Arial,sans-serif; margin:0; padding:0; display:flex; background:#e3f2fd; }
.sidebar { width:250px; background:#2196f3; color:#fff; height:100vh; display:flex; flex-direction:column; position:fixed; }
.sidebar-header { text-align:center; padding:20px 10px; border-bottom:2px solid #1976d2; }
.sidebar-header img { width:80px; height:auto; }
.sidebar-header h2 { margin:10px 0 0; font-size:1.5em; }
.menu { flex:1; display:flex; flex-direction:column; padding:20px 0; }
.menu a { display:flex; align-items:center; padding:12px 20px; color:white; text-decoration:none; font-weight:bold; transition:background 0.2s; }
.menu a img { width:28px; margin-right:12px; }
.menu a:hover { background:#1e88e5; }
.logout-btn { margin:20px; background:#64b5f6; color:#fff; border:none; padding:10px; border-radius:8px; font-weight:bold; cursor:pointer; transition:background 0.2s; }
.logout-btn:hover { background:#1e88e5; }
.main-content { margin-left:250px; flex:1; padding:20px 40px; }
h1 { text-align:center; color:#0d47a1; }

table { width:100%; border-collapse:collapse; }
th, td { padding:10px; border:1px solid #1976d2; text-align:left; }
th { background:#2196f3; color:white; }

.top-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
}
.top-buttons a {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: white;
    background-color: #64b5f6;
    padding: 8px 16px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
    font-size: 13px;
    min-width: 100px;
    text-align: center;
    transition: background 0.2s, transform 0.1s;
}
.top-buttons a:hover { background-color: #1e88e5; transform: scale(1.03); }
.top-buttons a.delete { background-color: #e53935; min-width: 110px; }
.top-buttons a.delete:hover { background-color: #c62828; }
.top-buttons a.edit { background-color: #fbc02d; color: black; }
.top-buttons a.edit:hover { background-color: #f9a825; }

.swal2-popup { border-radius: 12px; padding: 25px 20px; }
.swal2-input { width: 80% !important; height: 40px !important; font-size: 15px; border: 2px solid #2196f3; border-radius: 6px; padding: 8px 10px; }
.swal2-title { color: #0d47a1; font-weight: bold; }
.swal2-confirm { background-color: #2196f3 !important; color: white !important; border-radius: 6px !important; font-weight: bold; padding: 8px 18px !important; }
.swal2-cancel { background-color: #e53935 !important; color: white !important; border-radius: 6px !important; font-weight: bold; padding: 8px 18px !important; }
</style>
</head>
<body>
<div class="sidebar">
    <div class="sidebar-header">
        <img src="https://veltio.com/wp-content/uploads/2022/03/Farmacorp-logo.jpg" alt="Logo Farmacorp">
        <h2>FARMACORP</h2>
    </div>
    <div class="menu">
        <a href="{% url 'farmacia:sucursal' %}"><img src="https://cdn-icons-png.flaticon.com/128/13163/13163163.png" alt="Sucursal">SUCURSAL</a>
            <a href="{% url 'producto_listar' %}" class="menu-item"><img src="https://cdn-icons-png.flaticon.com/128/647/647237.png" alt="Productos">PRODUCTOS</a>
            <a href="{% url 'farmacia:inventario' %}"><img src="https://cdn-icons-png.flaticon.com/128/2825/2825867.png" alt="Inventario">INVENTARIO</a>
            <a href="{% url 'empleados:listar_empleados' %}"><img src="https://cdn-icons-png.flaticon.com/512/219/219983.png" alt="Empleados">EMPLEADOS</a>
            <a href="{% url 'clientes:listar_clientes' %}"><img src="https://cdn-icons-png.flaticon.com/128/6012/6012311.png" alt="Clientes">CLIENTES</a>
            <a href="{% url 'farmacia:receta' %}"><img src="https://cdn-icons-png.flaticon.com/128/4521/4521516.png" alt="Recetas">RECETAS</a>
            <a href="{% url 'farmacia:proveedor' %}"><img src="https://cdn-icons-png.flaticon.com/128/10839/10839198.png" alt="Proveedores">PROVEEDORES</a>
            <a href="{% url 'farmacia:reporte' %}"><img src="https://cdn-icons-png.flaticon.com/128/1055/1055644.png" alt="Reportes">REPORTES</a>
            <a href="{% url 'farmacia:alerta' %}"><img src="https://cdn-icons-png.flaticon.com/512/564/564619.png" alt="Alertas">ALERTAS</a>
            <a href="{% url 'farmacia:venta' %}"><img src="https://cdn-icons-png.flaticon.com/128/9362/9362302.png" alt="Ventas">VENTAS</a>
    </div>
    {% if usuario %}
    <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit" class="logout-btn">Cerrar sesi√≥n</button>
    </form>
    {% endif %}
</div>

<div class="main-content">
<h1>Listado de Sucursales</h1>

<div class="top-buttons">
    <a href="{% url 'sucursal:crear_sucursal' %}">‚ûï Crear</a>
    <a href="#" class="edit" onclick="editarSucursal()">‚úèÔ∏è Editar</a>
    <a href="#" class="delete" onclick="eliminarSucursal()">üóëÔ∏è Eliminar</a>
    <a href="{% url 'farmacia:listar_farmacia' %}">üè• Ver Todas las Farmacias</a>
    <a href="{% url 'farmacia:dashboard' %}">‚¨ÖÔ∏è Volver al Men√∫</a>
</div>

<table>
<tr>
    <th>ID</th>
    <th>Nombre</th>
    <th>Departamento</th>
    <th>NIT</th>
    <th>Email</th>
    <th>Direcci√≥n</th>
    <th>Horario</th>
    <th>Fecha Registro</th>
</tr>
{% for sucursal in sucursales %}
<tr>
    <td>{{ sucursal.id }}</td>
    <td>{{ sucursal.nombre }}</td>
    <td>{{ sucursal.departamento }}</td>
    <td>{{ sucursal.nit }}</td>
    <td>{{ sucursal.email }}</td>
    <td>{{ sucursal.direccion }}</td>
    <td>{{ sucursal.horario }}</td>
    <td>{{ sucursal.fecha_registro }}</td>
</tr>
{% empty %}
<tr>
    <td colspan="8" style="text-align:center;">No hay sucursales registradas.</td>
</tr>
{% endfor %}
</table>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function editarSucursal() {
    Swal.fire({
        title: 'Editar Sucursal',
        input: 'text',
        inputLabel: 'Ingrese el ID de la sucursal',
        inputPlaceholder: 'ID',
        showCancelButton: true,
        confirmButtonText: 'Aceptar',
        cancelButtonText: 'Cancelar',
        inputValidator: (value) => !value && 'Debes ingresar un ID'
    }).then(result => {
        if(result.isConfirmed){
            const id = result.value.trim();
            fetch(`/sucursal/verificar/${id}/`)
                .then(resp => resp.json())
                .then(data => {
                    if(data.existe){
                        window.location.href = `/sucursal/editar/${id}/`;
                    } else {
                        Swal.fire('ID no encontrado', `No existe la sucursal con ID ${id}`, 'error');
                    }
                });
        }
    });
}

function eliminarSucursal() {
    Swal.fire({
        title: 'Eliminar Sucursal',
        input: 'text',
        inputLabel: 'Ingrese el ID de la sucursal',
        inputPlaceholder: 'ID',
        showCancelButton: true,
        confirmButtonText: 'Aceptar',
        cancelButtonText: 'Cancelar',
        inputValidator: (value) => !value && 'Debes ingresar un ID'
    }).then(result => {
        if(result.isConfirmed){
            const id = result.value.trim();
            fetch(`/sucursal/verificar/${id}/`)
                .then(resp => resp.json())
                .then(data => {
                    if(data.existe){
                        // Confirmaci√≥n final
                        Swal.fire({
                            title: `¬øEliminar sucursal ${id}?`,
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonText: 'S√≠, eliminar',
                            cancelButtonText: 'Cancelar',
                            confirmButtonColor: '#e53935'
                        }).then(confirmResult => {
                            if(confirmResult.isConfirmed){
                                const form = document.createElement('form');
                                form.method = 'POST';
                                form.action = `/sucursal/eliminar/${id}/`;
                                const csrfInput = document.createElement('input');
                                csrfInput.type = 'hidden';
                                csrfInput.name = 'csrfmiddlewaretoken';
                                csrfInput.value = '{{ csrf_token }}';
                                form.appendChild(csrfInput);
                                document.body.appendChild(form);
                                form.submit();
                            }
                        });
                    } else {
                        Swal.fire('ID no encontrado', `No existe la sucursal con ID ${id}`, 'error');
                    }
                });
        }
    });
}

</script>
</body>
</html>
